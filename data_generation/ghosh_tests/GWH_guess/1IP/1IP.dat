import sys, os
sys.path.insert(1, '/usr/local/psi4/lib')
import psi4
sys.path.insert(1, '../../../')

import spinflip
from spinflip import sf_cas

mol_6 = psi4.core.Molecule.create_molecule_from_string("""
 3 7
 V   -3.151  -0.0931 -0.001
 V   3.1511  -0.093  0.0008
 C   -0.0003 -0.1301 -0.0003
 H   -0.0003 -1.2077 -0.0004
 C   -0.7064 1.9609  0.0268
 C   0.7055  1.9609  -0.027
 C   -1.4133 3.1688  0.0726
 H   -2.4924 3.182   0.134
 C   1.4125  3.1687  -0.0727
 H   2.4916  3.1817  -0.134
 C    -0.713  4.383   0.0413
 C   0.7124  4.383   -0.0412
 C   -1.4719 5.688   0.0898
 H   -1.1799 6.2952  0.9554
 H   -2.5505 5.5205  0.1512
 H   -1.2799 6.3014  -0.7992
 C   1.4713  5.6879  -0.0895
 H   1.1793  6.2953  -0.9548
 H   2.55    5.5203  -0.1512
 H   1.2796  6.301   0.7997
 N   -1.1547 0.605   0.0259
 N   1.1538  0.605   -0.0264
 C   -5.4355 -2.1731 -0.1351
 C   -6.7418 -2.6695 -0.0942
 H   -6.9459 -3.722  -0.204
 C   -7.8078 -1.7932 0.0935
 H   -8.8251 -2.1654 0.1312
 C   -7.5489 -0.4323 0.2285
 H   -8.3763 0.2436  0.3698
 C   -6.2309 0.0345  0.1774
 C   -4.2293 -3.1314 -0.3333
 C   -4.7373 -4.5853 -0.4987
 H   -3.9026 -5.2725 -0.6533
 H   -5.4095 -4.6758 -1.3529
 H   -5.2867 -4.9172 0.383
 C   -5.9216 1.5485  0.3044
 C   -7.244  2.3415  0.4544
 H   -7.7915 2.0343  1.3467
 H   -7.8991 2.1853  -0.4038
 H   -7.0478 3.4123  0.5354
 C   -3.3198 -3.0461 0.9216
 C   -3.1153 -4.1529 1.7596
 H   -3.5643 -5.1074 1.5352
 C   -2.3367 -4.0361 2.9137
 H   -2.2048 -4.8899 3.5684
 C   -1.7436 -2.8069 3.2044
 H   -1.1352 -2.6683 4.0888
 C   -1.9607 -1.7477 2.3304
 H   -1.5051 -0.7865 2.508
 C   -3.4468 -2.72   -1.6076
 C   -3.396  -3.5421 -2.7442
 H   -3.909  -4.4906 -2.7662
 C   -2.6873 -3.1405 -3.8795
 H   -2.6785 -3.7674 -4.764
 C   -1.9945 -1.9287 -3.849
 H   -1.4282 -1.5795 -4.7041
 C   -2.0683 -1.1586 -2.6937
 H   -1.5303 -0.2265 -2.6151
 C   -5.182  2.0258  -0.9765
 C   -5.7416 2.9804  -1.8386
 H   -6.7131 3.4042  -1.6398
 C   -5.0488 3.4039  -2.9765
 H   -5.4927 4.1348  -3.6426
 C   -3.7795 2.881   -3.2262
 H   -3.196  3.1964  -4.0822
 C   -3.2705 1.9403  -2.3387
 H   -2.2773 1.5442  -2.4755
 C   -5.033  1.8002  1.5529
 C   -5.4683 2.5929  2.6255
 H   -6.4521 3.0346  2.6248
 C   -4.6305 2.8304  3.7188
 H   -4.9772 3.4373  4.5474
 C   -3.3438 2.289   3.7135
 H   -2.6519 2.4698  4.5267
 C   -2.9634 1.5106  2.6271
 H   -1.9641 1.1086  2.5607
 N   -5.1881 -0.8346 0.005
 N   -2.741  -1.8457 1.2217
 N   -2.8044 -1.5159 -1.608
 N   -3.9534 1.4936  -1.2502
 N   -3.7878 1.2403  1.5792
 C   6.2309  0.0345  -0.1775
 C   7.5489  -0.4324 -0.2287
 H   8.3763  0.2435  -0.3701
 C   7.8078  -1.7932 -0.0937
 H   8.8251  -2.1655 -0.1315
 C   6.7418  -2.6695 0.0942
 H   6.9459  -3.722  0.204
 C   5.4355  -2.1731 0.1352
 C   5.9217  1.5486  -0.3044
 C   7.2441  2.3414  -0.4544
 H   7.7916  2.0342  -1.3467
 H   7.8992  2.1851  0.4037
 H   7.048   3.4123  -0.5354
 C   4.2293  -3.1314 0.3335
 C   4.7373  -4.5852 0.4992
 H   5.4096  -4.6756 1.3533
 H   5.2866  -4.9172 -0.3826
 H   3.9026  -5.2724 0.654
 C   5.0332  1.8003  -1.553
 C   5.4685  2.5931  -2.6255
 H   6.4524  3.0347  -2.6248
 C   4.6308  2.8306  -3.7189
 H   4.9776  3.4375  -4.5474
 C   3.3442  2.2893  -3.7137
 H   2.6523  2.4701  -4.5269
 C   2.9636  1.5109  -2.6273
 H   1.9643  1.1089  -2.561
 C   5.1821  2.0259  0.9764
 C   5.7418  2.9803  1.8387
 H   6.7134  3.404   1.64
 C   5.0491  3.4039  2.9766
 H   5.4931  4.1346  3.6428
 C   3.7796  2.8811  3.2262
 H   3.1963  3.1966  4.0822
 C   3.2706  1.9406  2.3386
 H   2.2773  1.5445  2.4754
 C   3.3198  -3.0462 -0.9213
 C   3.1153  -4.1532 -1.7592
 H   3.5641  -5.1077 -1.5345
 C   2.3368  -4.0365 -2.9134
 H   2.205   -4.8904 -3.568
 C   1.7441  -2.8073 -3.2045
 H   1.1359  -2.6687 -4.0892
 C   1.9611  -1.7479 -2.3307
 H   1.5058  -0.7867 -2.5086
 C   3.4468  -2.7198 1.6078
 C   3.3961  -3.5416 2.7446
 H   3.9093  -4.4901 2.7668
 C   2.6875  -3.1399 3.8799
 H   2.6789  -3.7666 4.7645
 C   1.9945  -1.9281 3.8491
 H   1.4283  -1.5788 4.7043
 C   2.0682  -1.1582 2.6937
 H   1.5302  -0.2262 2.6149
 N   5.1882  -0.8346 -0.005
 N   3.7879  1.2405  -1.5794
 N   3.9534  1.4938  1.2501
 N   2.7411  -1.8459 -1.2218
 N   2.8042  -1.5158 1.6081
 symmetry c1
""")

opts = {'basis': '6-31G', 'reference': 'rohf', 'memory': '90 Gb', 'guess': 'gwh'}

psi4.set_options(opts)
psi4.set_memory(90000000000)

e, wfn_ci, wfn_scf = sf_cas(4, 6, mol_6, conf_space="", add_opts=opts, return_ci_wfn=True, return_rohf_wfn=True, read_rohf_wfn="m6.npz")

# get mulliken charges
psi4.oeprop(wfn_scf, "MULLIKEN_CHARGES")
psi4.oeprop(wfn_ci, "MULLIKEN_CHARGES")


